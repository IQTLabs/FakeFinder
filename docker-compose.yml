version: '3.7'
services:
  dash:
    restart: always
    build:
      context: dash
    image: iqtlabs/fakefinder-dash
    ports:
      - 80:8050
    networks:
      - frontend
  api:
    restart: always
    build:
      context: api
    image: iqtlabs/fakefinder-api
    ports:
      - 5000:5000
    networks:
      - frontend
      - api
      - detectors
    volumes:
      - ./data/uploads:/uploads
  detectors:
    restart: always
    build:
      context: detectors
    image: iqtlabs/fakefinder-detectors
    networks:
      - detectors
    volumes:
      - ./data/weights:/weights
      - ./data/uploads:/uploads
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              capabilities: [gpu]
networks:
  api:
    name: api
  detectors:
    name: detectors
  frontend:
    name: frontend
