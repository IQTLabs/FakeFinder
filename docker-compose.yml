version: '3.7'
services:
  dash:
    restart: always
    build:
      context: dash
    image: iqtlabs/fakefinder-dash
    ports:
      - 80:8050
    networks:
      - frontend
  api:
    restart: always
    build:
      context: api
    image: iqtlabs/fakefinder-api
    ports:
      - 5000:5000
    networks:
      - frontend
      - api
      - detectors
    volumes:
      - ./uploads:/uploads
  boken:
    restart: always
    build:
      context: detectors/boken
    image: iqtlabs/fakefinder-boken
    networks:
      - detectors
    volumes:
      - ./weights:/weights
      - ./uploads:/uploads
  eighteen:
    restart: always
    build:
      context: detectors/eighteen
    image: iqtlabs/fakefinder-eighteen
    runtime: nvidia
    networks:
      - detectors
    volumes:
      - ./weights:/weights
      - ./uploads:/uploads
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              device_ids: ['0']
              capabilities: [gpu]
  medics:
    restart: always
    build:
      context: detectors/medics
    image: iqtlabs/fakefinder-medics
    runtime: nvidia
    networks:
      - detectors
    volumes:
      - ./weights:/weights
      - ./uploads:/uploads
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              device_ids: ['1']
              capabilities: [gpu]
  ntech:
    restart: always
    build:
      context: detectors/ntech
    image: iqtlabs/fakefinder-ntech
    runtime: nvidia
    networks:
      - detectors
    volumes:
      - ./weights:/weights
      - ./uploads:/uploads
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              device_ids: ['2']
              capabilities: [gpu]
  selimsef:
    restart: always
    build:
      context: detectors/selimsef
    image: iqtlabs/fakefinder-selimsef
    runtime: nvidia
    networks:
      - detectors
    volumes:
      - ./weights:/weights
      - ./uploads:/uploads
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              device_ids: ['2']
              capabilities: [gpu]
  wm:
    restart: always
    build:
      context: detectors/wm
    image: iqtlabs/fakefinder-wm
    runtime: nvidia
    networks:
      - detectors
    volumes:
      - ./weights:/weights
      - ./uploads:/uploads
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              device_ids: ['3']
              capabilities: [gpu]
networks:
  api:
    name: api
  detectors:
    name: detectors
  frontend:
    name: frontend
